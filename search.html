<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>æ–°é—»æ£€ç´¢ç³»ç»Ÿ - æ¾³æ¸¯çœæ—¥æŠ¥</title>
    <link rel="stylesheet" href="./fcyym.css" />
    <style>
        /* å…¨å±€èƒŒæ™¯æ”¹ä¸ºç™½è‰² - ä¸news_detailä¸€è‡´ */
        body {
            background-color: #ffffff !important;
            margin: 0;
            padding: 0;
            font-family: 'SimSun', 'å®‹ä½“', 'Microsoft YaHei', sans-serif;
            overflow-x: hidden;
        }

        /* å¤§å¹…åŠ å®½æ•´ä½“å®¹å™¨å®½åº¦ - ä¸news_detailä¸€è‡´ */
        .w1000 {
            width: 1400px !important;
            margin: 0 auto;
            display: flex;
        }

        /* æ¢å¤å·¦å³å¹¶æ’å¸ƒå±€ */
        .main {
            display: flex;
            justify-content: space-between;
            gap: 30px !important;
            padding: 0 20px;
            min-height: 800px;
        }

        /* å·¦ä¾§å†…å®¹åŒº - æœç´¢æ  */
        .paper-box {
            width: 20% !important;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            background: #fff;
            border: 1px solid #e4e4e4;
            padding: 20px;
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.08);
        }

        /* å³ä¾§å†…å®¹åŒº - æ€ç»´å¯¼å›¾ */
        .right-main {
            width: 75% !important;
            display: flex;
            flex-direction: column;
            align-items: center;
            background: #fff;
            border: 1px solid #e4e4e4;
            padding: 28px 32px;
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.08);
            position: relative;
            overflow: hidden;
        }

        /* æŠ¥çº¸å›¾ç‰‡æ ·å¼ */
        .paper img {
            width: 100% !important;
            max-width: 700px;
            height: auto !important;
        }

        /* æœç´¢åŒºåŸŸæ ·å¼ */
        .search-area {
            width: 100%;
            margin-bottom: 20px;
        }

        .search-title {
            font-size: 18px;
            font-weight: bold;
            color: #d7000f;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #d7000f;
        }

        .search-input-group {
            display: flex;
            gap: 8px;
            margin-bottom: 15px;
        }

        .search-input {
            flex: 1;
            padding: 10px;
            font-size: 15px;
            border: 1px solid #ccc;
            font-family: inherit;
        }

        .search-btn {
            padding: 10px 20px;
            background-color: #d7000f;
            color: white;
            border: none;
            cursor: pointer;
            font-size: 15px;
        }

        .search-btn:hover {
            background-color: #b0000c;
        }

        /* æœç´¢æç¤º */
        .search-hints {
            background-color: #f8f9fa;
            padding: 15px;
            margin-bottom: 20px;
            font-size: 13px;
            color: #666;
            border-left: 3px solid #d7000f;
        }

        .search-hints h4 {
            margin-top: 0;
            color: #333;
            font-size: 14px;
        }

        .search-hints ul {
            margin: 8px 0;
            padding-left: 18px;
        }

        .search-hints li {
            margin: 4px 0;
        }

        /* æœç´¢ç»“æœåˆ—è¡¨ */
        .results-list {
            list-style: none;
            padding: 0;
            margin: 0;
            width: 100%;
        }

        .result-item {
            padding: 12px;
            margin-bottom: 10px;
            background-color: #f5f5f5;
            border-left: 3px solid #ccc;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
        }

        .result-item:hover {
            border-left-color: #d7000f;
            background-color: #fff3f3;
        }

        .result-item.new {
            border-left-color: #d7000f;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { box-shadow: 0 0 5px rgba(215, 0, 15, 0.3); }
            50% { box-shadow: 0 0 15px rgba(215, 0, 15, 0.6); }
        }

        .result-title {
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }

        .result-meta {
            font-size: 12px;
            color: #888;
        }

        /* å†å²è®°å½• */
        .history-section {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px dashed #ccc;
        }

        .history-title {
            font-size: 14px;
            color: #666;
            margin-bottom: 10px;
        }

        .history-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .history-tag {
            padding: 5px 12px;
            background-color: #e9ecef;
            color: #555;
            font-size: 13px;
            cursor: pointer;
            border-radius: 3px;
        }

        .history-tag:hover {
            background-color: #d7000f;
            color: white;
        }

        /* ========== æ€ç»´å¯¼å›¾å®¹å™¨ - æ•´åˆmind2æ ·å¼ ========== */
        .mind-map-container {
            width: 100%;
            height: 700px;
            position: relative;
            background: #f0f0f0;
            overflow: hidden;
            font-family: 'Courier New', monospace;
            touch-action: none;
        }

        /* å¤å¤ç½‘æ ¼èƒŒæ™¯ */
        #grid {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
            background-image: 
              linear-gradient(#d0d0d0 1px, transparent 1px),
              linear-gradient(90deg, #d0d0d0 1px, transparent 1px);
            background-size: 40px 40px;
            background-repeat: repeat;
        }

        /* æ‰«æçº¿æ•ˆæœ */
        .scanlines {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(
              to bottom,
              rgba(255,255,255,0),
              rgba(255,255,255,0) 50%,
              rgba(0,0,0,0.03) 50%,
              rgba(0,0,0,0.03) 100%
            );
            background-size: 100% 4px;
            pointer-events: none;
            z-index: 999;
            opacity: 0.4;
        }

        /* ç”»å¸ƒå®¹å™¨ */
        #canvas-container {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            overflow: hidden;
            background: transparent;
        }

        #connection-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }

        #node-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 2;
            cursor: grab;
        }

        #node-layer:active { cursor: grabbing; }
        #node-layer.dragging-node { cursor: default; }

        /* ========== èŠ‚ç‚¹æ ·å¼ ========== */
        .node {
            position: absolute;
            background: #f0f0f0;
            border: 2px solid #2a2a2a;
            padding: 8px 16px;
            font-size: 14px;
            font-weight: bold;
            cursor: grab;
            user-select: none;
            z-index: 10;
            min-width: 80px;
            max-width: 300px;
            text-align: center;
            border-radius: 0;
            box-shadow: 4px 4px 0 rgba(0,0,0,0.2);
            transition: all 0.2s ease;
            word-wrap: break-word;
            line-height: 1.3;
            font-family: 'Courier Prime', 'Courier New', monospace;
        }

        .node:hover {
            transform: translate(-2px, -2px);
            box-shadow: 6px 6px 0 rgba(0,0,0,0.3);
            z-index: 20;
        }

        .node:active { cursor: grabbing; }

        /* é€‰ä¸­èŠ‚ç‚¹çš„é«˜äº®æ ·å¼ */
        .node.selected {
            border-color: #ff0040 !important;
            background: #ff0040 !important;
            color: white !important;
            box-shadow: 0 0 15px #ff0040, 4px 4px 0 rgba(0,0,0,0.3) !important;
            transform: translate(-2px, -2px);
            z-index: 100;
        }

        .node.dragging {
            z-index: 1000;
            box-shadow: 6px 6px 0 rgba(0,0,0,0.3);
            opacity: 0.9;
            transform: translate(-2px, -2px);
        }

        .node.merging {
            animation: mergePulse 0.5s ease-in-out infinite;
        }

        @keyframes mergePulse {
            0%, 100% { 
              box-shadow: 0 0 0 2px #8b0000, 0 0 20px #ff0040, 4px 4px 0 rgba(0,0,0,0.2);
              transform: translate(-50%, -50%) scale(1);
            }
            50% { 
              box-shadow: 0 0 0 4px #8b0000, 0 0 30px #ff0040, 6px 6px 0 rgba(0,0,0,0.3);
              transform: translate(-50%, -50%) scale(1.02);
            }
        }

        .node.clue-node {
            background: #fffacd;
            border-color: #d69e2e;
            border-width: 3px;
            color: #8b4513;
        }

        .node.clue-node::before {
            content: "ğŸ’¡";
            position: absolute;
            left: -25px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 18px;
        }

        .node.bookmarked {
            border-left: 4px solid #dc143c;
        }

        .node.bookmarked::after {
            content: "ğŸ”–";
            position: absolute;
            left: -20px;
            top: -10px;
            font-size: 16px;
        }

        /* æœªçŸ¥èŠ‚ç‚¹æ ·å¼ - ç”¨äºæœªè§£é”çš„æ–°é—»èŠ‚ç‚¹ */
        .node.unknown-node {
            background: #f5f5f5;
            border-color: #999;
            color: #777;
            font-style: italic;
            border-style: dashed;
        }

        .node.unknown-node::after {
            content: "?";
            position: absolute;
            right: -10px;
            top: -10px;
            background: #8b0000;
            color: white;
            width: 22px;
            height: 22px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: bold;
            border: 2px solid #2a2a2a;
        }

        /* æ–°é—»èŠ‚ç‚¹å¯ç‚¹å‡»æ ·å¼ - è§£é”åæ˜¾ç¤ºä¸ºç¼–å·æ ¼å¼ */
        .node.news-node {
            cursor: pointer;
            border-color: #0066cc;
            background: #f0f8ff;
        }

        .node.news-node.unlocked {
            background: #f0fff0;
            border-color: #28a745;
            font-size: 18px;
            font-weight: bold;
        }

        .node.news-node:hover {
            background: #0066cc;
            color: white;
            border-color: #004499;
        }

        .node input {
            border: none;
            background: transparent;
            font-family: inherit;
            font-size: inherit;
            font-weight: inherit;
            text-align: center;
            width: 100%;
            outline: none;
        }

        .node.level-0 { background: #d0d0d0; font-size: 18px; border-width: 3px; }
        .node.level-1 { background: #e0e0e0; font-size: 16px; }
        .node.level-2 { background: #f0f0f0; }
        .node.level-3 { background: #f5f5f5; }
        .node.level-4 { background: #fafafa; }
        .node.level-5 { background: #fdfdfd; }
        .node.level-6 { background: #fefefe; }

        /* åˆ é™¤åŒºåŸŸ */
        #trash-zone {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 100px;
            background: linear-gradient(to top, rgba(139,0,0,0.6), transparent);
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-size: 16px;
            font-weight: bold;
            opacity: 0;
            transition: opacity 0.25s;
            pointer-events: none;
            z-index: 50;
            border-top: 3px solid #8b0000;
            text-shadow: 1px 1px 0 #000;
        }

        #trash-zone.active { opacity: 1; }

        /* åˆå¹¶æç¤º */
        #merge-hint {
            position: absolute;
            top: 80px;
            left: 50%;
            transform: translateX(-50%);
            background: #d69e2e;
            color: #fff;
            padding: 10px 20px;
            font-size: 13px;
            font-weight: bold;
            display: none;
            z-index: 1001;
            border: 2px solid #2a2a2a;
            box-shadow: 4px 4px 0 rgba(0,0,0,0.2);
        }

        #merge-hint.active { display: block; }

        /* æ¨¡å¼æŒ‡ç¤ºå™¨ */
        .mode-indicator {
            position: absolute;
            top: 80px;
            right: 20px;
            background: #8b0000;
            color: #fff;
            padding: 8px 16px;
            font-size: 12px;
            display: none;
            z-index: 1001;
            border: 2px solid #2a2a2a;
            box-shadow: 4px 4px 0 rgba(0,0,0,0.2);
        }

        .mode-indicator.active { display: block; }

        /* å³é”®èœå• */
        .context-menu {
            position: absolute;
            background: #f0f0f0;
            border: 2px solid #2a2a2a;
            box-shadow: 6px 6px 0 rgba(0,0,0,0.2);
            z-index: 2000;
            display: none;
            min-width: 180px;
        }

        .context-menu-item {
            padding: 10px 16px;
            cursor: pointer;
            font-size: 13px;
            border-bottom: 1px solid #ccc;
            transition: background 0.1s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .context-menu-item:hover { background: #e0e0e0; }
        .context-menu-item:last-child { border-bottom: none; }
        .context-menu-item.merge-option { background: #fffacd; color: #8b4513; font-weight: bold; }
        .context-menu-item.merge-option:hover { background: #ffe5a3; }
        .context-menu-item.merge-option.disabled { opacity: 0.5; cursor: not-allowed; background: #f0f0f0; }

        /* ç¼©æ”¾æ§åˆ¶ */
        .zoom-controls {
            position: absolute;
            bottom: 30px;
            right: 20px;
            display: flex;
            flex-direction: column;
            gap: 5px;
            z-index: 800;
        }

        .zoom-btn {
            width: 40px;
            height: 40px;
            border: 2px solid #2a2a2a;
            background: #f0f0f0;
            font-size: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 4px 4px 0 rgba(0,0,0,0.2);
            transition: all 0.2s;
        }

        .zoom-btn:hover {
            background: #e0e0e0;
            transform: translate(-2px, -2px);
            box-shadow: 6px 6px 0 rgba(0,0,0,0.3);
        }

        /* å·¦ä¾§å›ºå®šé¢æ¿ (æ•´åˆæ•°æ®åº“æ ‡é¢˜å’Œå·¥å…·æ ) */
        .left-panel {
            position: absolute;
            top: 10px;
            left: 10px;
            width: 280px;
            background: rgba(240, 240, 240, 0.98);
            border: 3px solid #2a2a2a;
            box-shadow: 8px 8px 0 rgba(0,0,0,0.3);
            z-index: 1000;
            font-family: 'Courier Prime', 'Courier New', monospace;
            padding: 15px 12px;
            max-height: 600px;
            overflow-y: auto;
            backdrop-filter: blur(2px);
            pointer-events: auto;
        }

        .panel-header {
            border-bottom: 2px solid #2a2a2a;
            padding-bottom: 10px;
            margin-bottom: 12px;
        }

        .panel-header h1 {
            font-size: 14px;
            font-weight: 700;
            color: #2a2a2a;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
            line-height: 1.3;
        }

        .stats-box {
            background: rgba(0,0,0,0.05);
            border: 2px solid #2a2a2a;
            padding: 8px;
            font-size: 11px;
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            box-shadow: inset 2px 2px 0 rgba(0,0,0,0.1);
        }

        .toolbar-panel {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin: 12px 0;
        }

        .tool-row {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            justify-content: flex-start;
        }

        .panel-btn {
            background: #f0f0f0;
            border: 2px solid #2a2a2a;
            padding: 6px 8px;
            font-size: 11px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 3px 3px 0 rgba(0,0,0,0.2);
            transition: all 0.15s;
            display: inline-flex;
            align-items: center;
            gap: 4px;
            font-family: inherit;
            flex: 1 0 auto;
            min-width: 80px;
        }

        .panel-btn:hover {
            transform: translate(-2px, -2px);
            box-shadow: 5px 5px 0 rgba(0,0,0,0.3);
        }

        .panel-btn.active {
            background: #8b0000;
            color: white;
            border-color: #ff0040;
            box-shadow: 0 0 10px #ff0040, 3px 3px 0 rgba(0,0,0,0.3);
        }

        .legend-compact {
            margin-top: 12px;
            border-top: 2px solid #2a2a2a;
            padding-top: 12px;
        }

        .legend-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 10px;
        }

        .legend-symbol {
            width: 20px;
            height: 20px;
            border: 2px solid #2a2a2a;
            background: #f0f0f0;
            box-shadow: 2px 2px 0 rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 9px;
            flex-shrink: 0;
        }

        .legend-symbol.clue { background: #fffacd; border-color: #d69e2e; }
        .legend-symbol.bookmark { border-left: 4px solid #dc143c; background: #f0f0f0; }
        .legend-symbol.root { background: #d0d0d0; font-weight: bold; }

        /* çº¿ç´¢é¢æ¿ */
        #clue-panel {
            position: absolute;
            top: 80px;
            left: 300px;
            background: #fffacd;
            border: 3px solid #d69e2e;
            padding: 15px;
            font-size: 12px;
            z-index: 900;
            width: 280px;
            max-height: 350px;
            overflow-y: auto;
            display: none;
            box-shadow: 6px 6px 0 rgba(0,0,0,0.2);
        }

        #clue-panel.active { display: block; }

        #clue-panel h3 {
            margin-bottom: 12px;
            color: #8b4513;
            border-bottom: 2px solid #d69e2e;
            padding-bottom: 6px;
            font-weight: 700;
            font-size: 14px;
        }

        .clue-item {
            margin-bottom: 10px;
            padding: 8px;
            background: #fff;
            border: 1px solid #d69e2e;
            border-left: 4px solid #d69e2e;
            font-size: 11px;
        }

        /* æœ€ç»ˆçº¿ç´¢é¢æ¿ */
        #final-clue-panel {
            position: absolute;
            top: 80px;
            right: 20px;
            background: #2a2a2a;
            border: 3px solid #ff0040;
            padding: 15px;
            font-size: 12px;
            z-index: 1002;
            width: 300px;
            max-height: 400px;
            overflow-y: auto;
            display: none;
            box-shadow: 0 0 20px #ff0040, 6px 6px 0 rgba(0,0,0,0.3);
        }

        #final-clue-panel.active {
            display: block;
            animation: finalCluePulse 2s ease-in-out infinite;
        }

        @keyframes finalCluePulse {
            0%, 100% { box-shadow: 0 0 20px #ff0040, 6px 6px 0 rgba(0,0,0,0.3); }
            50% { box-shadow: 0 0 40px #ff0040, 8px 8px 0 rgba(0,0,0,0.3); }
        }

        #final-clue-panel h3 {
            margin-bottom: 12px;
            color: #ff0040;
            border-bottom: 2px solid #ff0040;
            padding-bottom: 6px;
            font-weight: 700;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .final-clue-item {
            margin-bottom: 12px;
            padding: 10px;
            background: #1a1a1a;
            border: 2px solid #444;
            border-left: 4px solid #ff0040;
            color: #f0f0f0;
        }

        .final-clue-item h4 {
            color: #daa520;
            margin-bottom: 6px;
            font-size: 12px;
        }

        .final-clue-item .password-list {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-top: 6px;
        }

        .password-tag {
            background: #8b0000;
            color: white;
            padding: 3px 8px;
            border-radius: 0;
            font-weight: bold;
            border: 1px solid #ff0040;
            box-shadow: 2px 2px 0 rgba(0,0,0,0.3);
            font-size: 11px;
        }

        /* çŠ¶æ€æ  */
        .status-bar {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 22px;
            background: #2a2a2a;
            color: #f0f0f0;
            font-size: 10px;
            display: flex;
            align-items: center;
            padding: 0 15px;
            z-index: 1000;
            border-top: 1px solid #000;
            font-family: 'Courier New', monospace;
        }

        /* é¡¶éƒ¨å¯¼èˆª - ä¸news_detailä¸€è‡´ */
        .top {
            background: #fff;
            border-bottom: 1px solid #e0e0e0;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .top .w1000 {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 0;
        }

        /* è¡Œæ¥·æ–‡å­—logo */
        .logo {
            font-family: "STXingkai", "Microsoft YaHei", sans-serif;
            font-size: 28px;
            color: #ff0040;
            text-decoration: none;
            font-weight: 500;
        }

        .nav {
            display: flex;
            gap: 35px;
            font-size: 17px;
            position: relative;
        }
        
        /* ä¸‹æ‹‰èœå•æ ·å¼ - ä¿æŒåŸæ · */
        .nav li {
            list-style: none;
            position: relative;
            cursor: pointer;
        }
        
        .nav ul {
            display: none;
            position: absolute;
            top: 100%;
            left: 0;
            background: white;
            border: 1px solid #ccc;
            padding: 8px 0;
            min-width: 120px;
            z-index: 1000;
        }
        
        .nav li:hover ul {
            display: block;
        }
        
        .nav ul li {
            padding: 5px 15px;
            white-space: nowrap;
        }
        
        .nav ul li:hover {
            background-color: #f5f5f5;
        }
        
        .nav ul li a {
            color: #333;
            text-decoration: none;
        }

        /* æ—¥æœŸæ  - ä¸news_detailä¸€è‡´ */
        .date-box {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 16px;
            color: #444;
            width: 100%;
            margin-bottom: 20px;
        }

        /* æ¿å—æŒ‰é’®ç½‘æ ¼ */
        .swiper-box {
            margin: 22px 0 26px;
            width: 100%;
        }

        .swiper-container {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            grid-template-rows: repeat(2, 1fr);
            gap: 2px;
            padding: 0;
            width: 100%;
            margin-bottom: 20px;
        }

        .swiper-slide {
            background-color: #d7000f;
            color: white;
            font-size: 18px;
            text-align: center;
            padding: 12px 0;
            box-sizing: border-box;
            display: flex;
            align-items: center;
            justify-content: center;
            height: 60px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .swiper-slide:hover {
            background-color: #b0000c;
        }

        .swiper-slide a {
            color: white;
            text-decoration: none;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* éšè—é¡µè„šç‰ˆæƒä¿¡æ¯ */
        .copyright {
            display: none !important;
        }

        /* åº•éƒ¨ */
        .bottom {
            background: #fff;
            border-top: 1px solid #e0e0e0;
            padding: 26px 0 40px;
        }

        /* è¿”å›é¡¶éƒ¨ */
        .go-top {
            position: fixed;
            right: 32px;
            bottom: 48px;
            width: 48px;
            height: 48px;
            cursor: pointer;
            border-radius: 50%;
            box-shadow: 0 8px 18px rgba(0, 0, 0, 0.16);
            overflow: hidden;
            transition: transform 0.2s ease;
            background: #fff;
            opacity: 0;
            pointer-events: none;
        }

        .go-top:hover {
            transform: translateY(-6px);
        }

        .go-top img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* æ— ç»“æœæç¤º */
        .no-results {
            text-align: center;
            padding: 50px;
            color: #666;
        }

        /* åŠ è½½çŠ¶æ€ */
        .loading {
            text-align: center;
            padding: 100px;
            color: #666;
        }

        /* å¼•å…¥åœ¨çº¿è¡Œæ¥·å­—ä½“ */
        @font-face {
            font-family: 'STXingkai';
            src: url('https://fonts.gstatic.com/s/notosanssc/v24/k3k68XPNpWRmgQ73v60CSLpGF90me5j.woff2') format('woff2');
            font-weight: normal;
            font-style: normal;
        }

        /* å­˜æ¡£æŒ‰é’®æ ·å¼ - å·¦ä¾§æœç´¢æ åº•éƒ¨åªä¿ç•™ä¸¤ä¸ªæŒ‰é’® */
        .archive-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            width: 100%;
        }
        .archive-btn {
            flex: 1;
            padding: 8px 0;
            background-color: #2c3e50;
            color: white;
            border: none;
            cursor: pointer;
            font-size: 13px;
            border-radius: 4px;
            text-align: center;
        }
        .archive-btn.reset { background-color: #7f8c8d; }
        .archive-btn.import { background-color: #27ae60; }
        .archive-btn:hover { opacity: 0.85; }
    </style>
    <base target="_blank">
</head>
<body>
    <div class="top">
        <div class="w1000">
            <a class="logo" href="website1.html" rel="noreferrer">æ¾³æ¸¯çœæ—¥æŠ¥</a>
            <ul class="nav">
                <li id="ribao">
                    æ—¥æŠ¥
                    <ul class="ribao">
                        <li><a target="_blank" rel="noreferrer">äººæ°‘æ—¥æŠ¥</a></li>
                        <li><a target="_blank" rel="noreferrer">äººæ°‘æ—¥æŠ¥æµ·å¤–ç‰ˆ</a></li>
                        <li><a href="graph.html" target="_blank" rel="noreferrer">ç¯çƒæ—¶æŠ¥</a></li>
                        <li><a target="_blank" rel="noreferrer">è¯åˆ¸æ—¶æŠ¥</a></li>
                    </ul>
                </li>
                <li id="zhoubao">
                    å‘¨æŠ¥
                    <ul class="zhoubao">
                        <li><a target="_blank" rel="noreferrer">å›½é™…é‡‘èæŠ¥</a></li>
                        <li><a target="_blank" rel="noreferrer">ä¸­å›½èƒ½æºæŠ¥</a></li>
                        <li><a target="_blank" rel="noreferrer">å¥åº·æ—¶æŠ¥</a></li>
                        <li><a target="_blank" rel="noreferrer">è®½åˆºä¸å¹½é»˜</a></li>
                        <li><a target="_blank" rel="noreferrer">ä¸­å›½åŸå¸‚æŠ¥</a></li>
                    </ul>
                </li>
                <li id="zazhi">
                    æ‚å¿—
                    <ul class="zazhi">
                        <li><a target="_blank" rel="noreferrer">æ–°é—»æˆ˜çº¿</a></li>
                        <li><a target="_blank" rel="noreferrer">äººæ°‘è®ºå›</a></li>
                        <li><a target="_blank" rel="noreferrer">äººæ°‘å‘¨åˆŠ</a></li>
                        <li><a target="_blank" rel="noreferrer">ä¸­å›½ç»æµå‘¨åˆŠ</a></li>
                        <li><a target="_blank" rel="noreferrer">æ°‘ç”Ÿå‘¨åˆŠ</a></li>
                        <li><a target="_blank" rel="noreferrer">å›½å®¶äººæ–‡å†å²</a></li>
                        <li><a target="_blank" rel="noreferrer">ä¸­å›½æŠ¥ä¸š</a></li>
                    </ul>
                </li>
            </ul>
        </div>
    </div>

    <div class="main w1000">
        <!-- å·¦ä¾§ï¼šæœç´¢æ  -->
        <div class="paper-box">
            <div class="search-area">
                <div class="search-title">ğŸ“° æ–°é—»æ£€ç´¢ç³»ç»Ÿ</div>

                <div class="search-input-group">
                    <input type="text" id="searchInput" class="search-input" placeholder="è¾“å…¥å…³é”®è¯..." onkeypress="if(event.key==='Enter') performSearch()" />
                    <button class="search-btn" onclick="performSearch()">æœç´¢</button>
                </div>

                <div class="search-hints">
                    <h4>ğŸ’¡ è°ƒæŸ¥æç¤º</h4>
                    <ul>
                        <li>1.é€šè¿‡æœç´¢è¯è¯­å¯ä»¥è§£é”æ–°é—»å†…å®¹ï¼Œè§£é”çš„æ–°é—»å°†ä¼šåœ¨å³ä¾§çš„æ€ç»´å¯¼å›¾ä¸­æœ‰æ‰€æ˜¾ç¤º</li>
                        <li>2.å¯ä»¥æœç´¢äººåã€åœ°ç‚¹ã€å…¬å¸ç­‰å†…å®¹ï¼Œæœç´¢çš„å…³é”®è¯åªæœ‰ä¸€ä¸ªï¼Œä¸ä¼šå‡ºç°éœ€è¦è¾“å…¥ä¸¤ä¸ªè¯ä»¥ä¸Šè¿›è¡ŒæŸ¥è¯¢çš„æ–¹å¼ã€‚</li>
                        <li>ä»¥ä¸‹æ˜¯ä¾‹å­ï¼šæ¯”å¦‚å¯ä»¥æœç´¢<strong>äººåï¼š</strong>æ—é™æ€¡ã€å¼ è¯š</li>
                        <li>3.å³ä¾§çš„æ€ç»´å¯¼å›¾ä¸­å¯ä»¥è¿›è¡Œä¸¤ä¸¤çš„æ–°é—»åˆå¹¶ï¼Œæœ‰åŠ©äºå¯¹äºæ¡ˆä»¶çš„ç†è§£è¿›è¡Œæœ‰æ‰€æ¨è¿›</li>
                    </ul>
                </div>

                <!-- æœç´¢ç»“æœ -->
                <div id="searchResults">
                    <div class="no-results" style="padding: 20px; color: #999;">
                        è¾“å…¥å…³é”®è¯å¼€å§‹è°ƒæŸ¥...
                    </div>
                </div>

                <!-- æœç´¢å†å² -->
                <div class="history-section" id="historySection" style="display: none;">
                    <div class="history-title">ğŸ“‹ æœç´¢å†å²</div>
                    <div class="history-tags" id="historyTags"></div>
                </div>

                <!-- åªä¿ç•™æ¸…é™¤å’Œå¯¼å…¥ä¸¤ä¸ªæŒ‰é’®ï¼Œå¯¼å‡ºæŒ‰é’®åœ¨æ€ç»´å¯¼å›¾é¢æ¿ä¸Š -->
                <div class="archive-buttons">
                    <button class="archive-btn reset" onclick="resetGameState()">ğŸ—‘ï¸ æ¸…é™¤å­˜æ¡£</button>
                    <button class="archive-btn import" onclick="document.getElementById('importFile').click()">ğŸ“‚ å¯¼å…¥å­˜æ¡£</button>
                </div>
                <input type="file" id="importFile" accept=".json,application/json" style="display:none;" onchange="handleFileImport(event)" />
            </div>
        </div>

        <!-- å³ä¾§ï¼šæ€ç»´å¯¼å›¾ -->
        <div class="right-main">
            <div class="date-box">
                <p class="date" style="font-size: 18px; font-weight: bold;">
                    è°ƒæŸ¥çº¿ç´¢å¢™
                    <span class="newstime" style="font-weight: normal; color: #666;">CLUE DATABASE</span>
                </p>
                <p></p>
            </div>

            <!-- æ¿å—æŒ‰é’® -->
            <div class="swiper-box">
                <div class="swiper-container" id="section-grid">
                    <div class="swiper-slide"><a href="#">01ç‰ˆï¼šè¦é—»</a></div>
                    <div class="swiper-slide"><a href="#">02ç‰ˆï¼šç¤¾ä¼šèµ°ç¬”</a></div>
                    <div class="swiper-slide"><a href="#">03ç‰ˆï¼šä¼—ç”Ÿç›¸</a></div>
                    <div class="swiper-slide"><a href="#">04ç‰ˆï¼šæ¼«ç”»ç”Ÿæ´»</a></div>
                    <div class="swiper-slide"><a href="#">05ç‰ˆï¼šå¤–å›½å¹½é»˜</a></div>
                    <div class="swiper-slide"><a href="#">06ç‰ˆï¼šå¼€å¿ƒé©¿ç«™</a></div>
                    <div class="swiper-slide"><a href="#">07ç‰ˆï¼šç§‘æŠ€å‰æ²¿</a></div>
                    <div class="swiper-slide"><a href="#">08ç‰ˆï¼šæ¼«ç”»è§‚å¯Ÿ</a></div>
                    <div class="swiper-slide"><a href="#">09ç‰ˆï¼šæ–°ç”Ÿä»£</a></div>
                    <div class="swiper-slide"><a href="#">10ç‰ˆï¼šè§£å¿§é¦†</a></div>
                    <div class="swiper-slide"><a href="#">11ç‰ˆï¼šç¤¾ä¼šè¶£ç”»</a></div>
                    <div class="swiper-slide"><a href="#">12ç‰ˆï¼šåŠ¨æ¼«</a></div>
                </div>
            </div>

            <!-- æ€ç»´å¯¼å›¾å®¹å™¨ - æ•´åˆmind2åŠŸèƒ½ -->
            <div class="mind-map-container" id="mindMap">
                <!-- æ‰«æçº¿ -->
                <div class="scanlines"></div>

                <!-- å·¦ä¾§å›ºå®šé¢æ¿ -->
                <div class="left-panel" id="leftPanel">
                    <div class="panel-header">
                        <h1>ğŸ“ æ¡ˆä»¶è°ƒæŸ¥æ•°æ®åº“<br>å—å±±å¸‚11Â·11åˆ‘æ¡ˆ</h1>
                        <div class="stats-box" id="panelStats">
                            <span>èŠ‚ç‚¹: <span id="statNodes">0</span></span>
                            <span>è¿æ¥: <span id="statConnections">0</span></span>
                            <span>çº¿ç´¢: <span id="statClues">0</span></span>
                            <span>é€‰ä¸­: <span id="statSelected">0</span></span>
                        </div>
                    </div>

                    <div class="toolbar-panel">
                        <div class="tool-row">
                            <button class="panel-btn" onclick="addNode()">â• æ·»åŠ èŠ‚ç‚¹</button>
                            <button class="panel-btn" id="connectBtn" onclick="toggleConnectMode()">ğŸ”— è¿æ¥æ¨¡å¼</button>
                        </div>
                        <div class="tool-row">
                            <button class="panel-btn" id="mergeBtn" onclick="toggleMergeMode()">ğŸ”€ åˆå¹¶æ¨¡å¼ï¼ˆä¸€å…±è¿›è¡Œ10æ¬¡åˆå¹¶æ“ä½œï¼‰</button>
                        </div>
                        <div class="tool-row">
                            <button class="panel-btn" onclick="deleteSelected()">ğŸ—‘ï¸ åˆ é™¤é€‰ä¸­</button>
                            <button class="panel-btn" onclick="toggleBookmark()">ğŸ”– ä¹¦ç­¾</button>
                            <button class="panel-btn" onclick="toggleUnknown()">â“ æœªçŸ¥ï¼ˆ01æ–°é—»åˆå§‹è®¾ç½®ä¸ºå·²çŸ¥çŠ¶æ€ï¼‰</button>
                        </div>
                        <div class="tool-row">
                            <button class="panel-btn" onclick="toggleCluePanel()">ğŸ’¡ çº¿ç´¢é¢æ¿</button>
                            <!-- ä¿®æ”¹ï¼šå°†åŸæ¥çš„å¯¼å‡ºæŒ‰é’®æ”¹ä¸ºå¯¼å‡ºæ¸¸æˆè¿›åº¦ -->
                            <button class="panel-btn" onclick="exportGameProgress()">ğŸ’¾ å¯¼å‡ºå­˜æ¡£</button>
                            <button class="panel-btn" onclick="resetView()">âŒ‚ é‡ç½®è§†å›¾</button>
                        </div>
                    </div>

                    <div class="legend-compact">
                        <div class="legend-grid">
                            <div class="legend-item"><div class="legend-symbol root">å§‹</div> <span>è°ƒæŸ¥èµ·ç‚¹</span></div>
                            <div class="legend-item"><div class="legend-symbol" style="background:#e0e0e0;">åœ°</div> <span>åœ°ç‚¹/æœºæ„</span></div>
                            <div class="legend-item"><div class="legend-symbol">ã€ã€‘</div> <span>æ¡ˆä»¶åºå·</span></div>
                            <div class="legend-item"><div class="legend-symbol clue">ğŸ’¡</div> <span>åˆå¹¶çº¿ç´¢</span></div>
                            <div class="legend-item"><div class="legend-symbol bookmark">â–Œ</div> <span>å·²ä¹¦ç­¾</span></div>
                            <div class="legend-item"><div class="legend-symbol" style="background:#fff;">?</div> <span>æœªçŸ¥æ ‡è®°</span></div>
                        </div>
                        <div style="margin-top:10px; font-size:10px; color:#666; border-top:1px dashed #aaa; padding-top:6px;">
                            <span>æ‹–æ‹½ç§»åŠ¨ | åŒå‡»ç¼–è¾‘ | å³é”®èœå• | Shiftå¤šé€‰ | Deleteåˆ é™¤ | æ»šè½®ç¼©æ”¾</span>
                            <span><br>æ•´ä¸ªå¯¼å›¾çš„è¯¦ç»†ä½¿ç”¨æ•™ç¨‹è¯¦è§é‚®ç®±</span>
                        </div>
                    </div>
                </div>

                <!-- æ¨¡å¼æŒ‡ç¤ºå™¨ -->
                <div class="mode-indicator" id="modeIndicator">è¿æ¥æ¨¡å¼ï¼šç‚¹å‡»ä¸¤ä¸ªèŠ‚ç‚¹åˆ›å»ºè¿æ¥</div>

                <!-- åˆå¹¶æç¤º -->
                <div id="merge-hint">åˆå¹¶æ¨¡å¼ï¼šé€‰æ‹©ä¸¤ä¸ªèŠ‚ç‚¹è¿›è¡Œçº¿ç´¢åˆå¹¶</div>

                <!-- çº¿ç´¢é¢æ¿ -->
                <div id="clue-panel">
                    <h3>ğŸ•µï¸ æ¨ç†æ‰€å¾—æ–°çº¿ç´¢</h3>
                    <div id="clue-list"></div>
                </div>

                <!-- æœ€ç»ˆçº¿ç´¢é¢æ¿ -->
                <div id="final-clue-panel">
                    <h3>ğŸ” ç»ˆæçº¿ç´¢å·²è§£é”</h3>
                    <div id="final-clue-list"></div>
                </div>

                <!-- ç”»å¸ƒå®¹å™¨ -->
                <div id="canvas-container">
                    <div id="grid"></div>
                    <canvas id="connection-canvas"></canvas>
                    <div id="node-layer"></div>
                </div>

                <!-- åˆ é™¤åŒºåŸŸ -->
                <div id="trash-zone">æ‹–åˆ°åº•éƒ¨åˆ é™¤</div>

                <!-- ç¼©æ”¾æ§åˆ¶ -->
                <div class="zoom-controls">
                    <button class="zoom-btn" onclick="zoomIn()" title="æ”¾å¤§">+</button>
                    <button class="zoom-btn" onclick="resetView()" title="é‡ç½®">âŒ‚</button>
                    <button class="zoom-btn" onclick="zoomOut()" title="ç¼©å°">-</button>
                </div>

                <!-- å³é”®èœå• -->
                <div class="context-menu" id="contextMenu">
                    <div class="context-menu-item" onclick="editNode()">âœï¸ ç¼–è¾‘æ–‡æœ¬</div>
                    <div class="context-menu-item" onclick="toggleBookmark()">ğŸ”– åˆ‡æ¢ä¹¦ç­¾</div>
                    <div class="context-menu-item" onclick="toggleUnknown()">â“ æ ‡è®°æœªçŸ¥</div>
                    <div class="context-menu-item" onclick="openNewsFromContext()">ğŸ“° æŸ¥çœ‹æ–°é—»</div>
                    <div class="context-menu-item merge-option" id="contextMergeBtn" onclick="tryMergeFromContext()">ğŸ”€ åˆå¹¶é€‰ä¸­èŠ‚ç‚¹</div>
                    <div class="context-menu-item" onclick="deleteSelected()" style="color:#8b0000;">ğŸ—‘ï¸ åˆ é™¤èŠ‚ç‚¹</div>
                </div>

                <!-- çŠ¶æ€æ  -->
                <div class="status-bar">
                    <span id="statusText">å°±ç»ª - èŠ‚ç‚¹æ•°: 0 | è¿æ¥æ•°: 0 | çº¿ç´¢: 0 | é€‰ä¸­: 0 | ç¼©æ”¾: 100%</span>
                </div>
            </div>
        </div>
    </div>

    <div class="bottom">
        <div class="w1000">
            <div class="copyright"></div>
        </div>
    </div>

    <div class="go-top" id="go-top" aria-label="è¿”å›é¡¶éƒ¨">
        <img src="https://paper.people.com.cn/testx/template/amucsite/projectPaper/rmPaper/files/go_top.png" alt="è¿”å›é¡¶éƒ¨" />
    </div>

    <script>
        // ==================== é…ç½® ====================
        const CONFIG = {
            gridSize: 40,
            snapThreshold: 20,
            scaleMin: 0.15,
            scaleMax: 3,
            zoomStep: 0.1,
            colors: {
                line: '#2a2a2a',
                lineSelected: '#ff0040',
                arrow: '#333333',
                grid: '#d0d0d0'
            }
        };

        // ==================== çº¿ç´¢åˆå¹¶è§„åˆ™ ====================
        const MERGE_RULES = [
            { sources: ['n16', 'n15'], result: 'ç¡®è®¤è®°è€…"è‹ç±³"å³ä¸ºæ¯•æ•ã€‚', id: 'clue_1' },
            { sources: ['n19', 'n31'], result: 'æ—é™æ€¡çš„è¡ŒåŠ¨è·¯çº¿ï¼Œå…¶10æ—¥æ™šæ˜¯ä»æ·±å—å¸‚å‰å¾€å—å±±å¸‚çš„ã€‚', id: 'clue_2a', nextStep: { sources: ['clue_2a', 'n3'], result: 'æ—é™æ€¡å› è½¦æ¬¡å–æ¶ˆï¼Œä»¥åŠé¡»å‰å¾€å—å±±å¸‚å‚åŠ å±•ä¼šçš„åŸå› ï¼Œè¢«è¿«æ”¹ä¹˜äº†å…¶ä»–è½¦æ¬¡ã€‚', id: 'clue_2' } },
            { sources: ['n12', 'n14'], result: 'ç¡®è®¤æ—é™æ€¡ä¸ºç¨€æœ‰è¡€å‹ï¼ˆç†ŠçŒ«è¡€ï¼‰ã€‚', id: 'clue_3' },
            { sources: ['n24', 'n46'], result: 'é’ˆå¯¹ç¨€æœ‰è¡€å‹çš„éæ³•éœ€æ±‚ï¼Œå¯èƒ½æ„æˆæ€äººåŠ¨æœºã€‚', id: 'clue_4' },
            { sources: ['n10', 'n28'], result: 'æ—é™æ€¡é€‰æ‹©æˆ–å¯èƒ½å…¥ä½æå¸Œä¸°å›½é™…é…’åº—çš„åŸå› ã€‚', id: 'clue_5a' },
            { sources: ['n20', 'n29'], result: 'æ—é™æ€¡é€‰æ‹©æˆ–å¯èƒ½å…¥ä½æå¸Œä¸°å›½é™…é…’åº—çš„åŸå› ã€‚', id: 'clue_5b' },
            { sources: ['n47', 'n44'], result: 'æ­»è€…ä¸ˆå¤«å‘¨å˜åœ¨æ¡ˆå‘æ—¶é—´ï¼ˆ11æœˆ10æ—¥æ™šï¼‰çš„åŠ¨å‘ï¼Œå¯è€ƒè™‘ä½œä¸ºæ’é™¤å…¶å«Œç–‘æ—¶çš„ä¾æ®ã€‚', id: 'clue_6' },
            { sources: ['n9', 'n41'], result: 'åˆ©ç”¨ç†ç–—èˆ±å’Œç‰¹å®šè¯ç‰©ï¼ˆç¯è‹¯æ‰æ—ï¼‰ç»“åˆï¼Œå¯èƒ½æ„æˆä¸€å¥—ä½œæ¡ˆæ‰‹æ³•ã€‚', id: 'clue_7' },
            { sources: ['n7', 'n21'], result: 'SBTPç³»ç»Ÿä¸­å¯èƒ½å­˜åœ¨æœªè¢«æ¸…ç†çš„å¹½çµè´¦å·ï¼Œä¸ºä½œæ¡ˆæˆ–æ•°æ®ç¯¡æ”¹æä¾›å¯èƒ½ã€‚', id: 'clue_8' }
        ];

        // æ€»çº¿ç´¢æ•°é‡
        const TOTAL_CLUES = 10;

        // ==================== çŠ¶æ€ç®¡ç† ====================
        let nodes = [];
        let connections = [];
        let selectedNodes = [];
        let connectMode = false;
        let mergeMode = false;
        let connectStart = null;
        let mergeStart = null;
        let nodeIdCounter = 0;
        let clueCounter = 0;
        let discoveredClues = [];
        let finalCluesShown = false;
        let scale = 1;
        let offsetX = 0;
        let offsetY = 0;

        let isDragging = false;
        let dragNode = null;
        let dragOffset = { x: 0, y: 0 };
        let isPanning = false;
        let panStart = { x: 0, y: 0 };
        let panOffsetStart = { x: 0, y: 0 };

        // æ–°é—»æ•°æ®åº“
        let newsDatabase = null;

        const container = document.getElementById('canvas-container');
        const grid = document.getElementById('grid');
        const nodeLayer = document.getElementById('node-layer');
        const connCanvas = document.getElementById('connection-canvas');
        const connCtx = connCanvas.getContext('2d');

        // ==================== åˆå§‹åŒ–æ•°æ® (mind2å®Œæ•´æ ‘å½¢å¸ƒå±€) ====================
        const initialData = {
            nodes: [
                { id: 'start', text: 'å¼€å§‹è°ƒæŸ¥', x: 0, y: -400, level: 0 },
                { id: 'root1', text: 'å—å±±å¸‚', x: -2400, y: 0, level: 1 },
                { id: 'root2', text: 'æ·±å—å¸‚', x: -1200, y: 0, level: 1 },
                { id: 'root3', text: 'æ—é™æ€¡', x: 0, y: 0, level: 1 },
                { id: 'root4', text: 'åƒç¦§ä¼šè®¡äº‹åŠ¡æ‰€', x: 1200, y: 0, level: 1 },
                { id: 'root5', text: 'å¤©è·¯åˆ†å±€', x: 2400, y: 0, level: 1 },
                { id: 'root6', text: 'é‡‘èåŸ', x: 3600, y: 0, level: 1 },
                { id: 'root7', text: 'æå¸Œä¸°ä¼šæ‰€', x: 4800, y: 0, level: 1 },
                // ç¬¬äºŒå±‚èŠ‚ç‚¹
                { id: 'n2', text: 'ã€2ã€‘', x: -5400, y: 500, level: 2, parent: 'root1', newsId: 'article_002' },
                { id: 'n3', text: 'ã€3ã€‘', x: -2400, y: 500, level: 2, parent: 'root1', newsId: 'article_003' },
                { id: 'n4', text: 'ã€4ã€‘', x: -4200, y: 500, level: 2, parent: 'root1', newsId: 'article_004' },
                { id: 'n6', text: 'ã€6ã€‘', x: -1800, y: 500, level: 2, parent: 'root1', newsId: 'article_006' },
                { id: 'n30', text: 'ã€30ã€‘', x: -3000, y: 500, level: 2, parent: 'root1', newsId: 'article_030' },
                { id: 'n27', text: 'ã€27ã€‘', x: -3600, y: 500, level: 2, parent: 'root1', newsId: 'article_027' },
                { id: 'n31', text: 'ã€31ã€‘', x: -4800, y: 500, level: 2, parent: 'root1', newsId: 'article_031' },
                { id: 'n50', text: 'ã€50ã€‘', x: -6000, y: 500, level: 2, parent: 'root1', newsId: 'article_050' },
                // ä¸‰å±‚èŠ‚ç‚¹ï¼ˆn2ä¸‹ï¼‰
                { id: 'n7', text: 'ã€7ã€‘', x: -7800, y: 1000, level: 3, parent: 'n2', newsId: 'article_007' },
                { id: 'n10', text: 'ã€10ã€‘', x: -7200, y: 1000, level: 3, parent: 'n2', newsId: 'article_010' },
                { id: 'n21', text: 'ã€21ã€‘', x: -6600, y: 1000, level: 3, parent: 'n2', newsId: 'article_021' },
                { id: 'n33', text: 'ã€33ã€‘', x: -6000, y: 1000, level: 3, parent: 'n2', newsId: 'article_033' },
                { id: 'n36', text: 'ã€36ã€‘', x: -5400, y: 1000, level: 3, parent: 'n2', newsId: 'article_036' },
                // å››å±‚èŠ‚ç‚¹ï¼ˆn2ä¸‹å­èŠ‚ç‚¹ï¼‰
                { id: 'n43', text: 'ã€43ã€‘', x: -8400, y: 1500, level: 4, parent: 'n7', newsId: 'article_043' },
                { id: 'n20', text: 'ã€20ã€‘', x: -7800, y: 1500, level: 4, parent: 'n10', newsId: 'article_020' },
                { id: 'n28', text: 'ã€28ã€‘', x: -7400, y: 1500, level: 4, parent: 'n10', newsId: 'article_028' },
                { id: 'n32', text: 'ã€32ã€‘', x: -7000, y: 1500, level: 4, parent: 'n10', newsId: 'article_032' },
                { id: 'n19', text: 'ã€19ã€‘', x: -4800, y: 1000, level: 3, parent: 'n31', newsId: 'article_019' },
                // ä¸‰å±‚èŠ‚ç‚¹ï¼ˆn3ä¸‹ï¼‰
                { id: 'n25', text: 'ã€25ã€‘', x: -2400, y: 1000, level: 3, parent: 'n3', newsId: 'article_025' },
                // å››å±‚èŠ‚ç‚¹ï¼ˆn3ä¸‹ï¼‰
                { id: 'n5', text: 'ã€5ã€‘', x: -3200, y: 1500, level: 4, parent: 'n25', newsId: 'article_005' },
                { id: 'n13', text: 'ã€13ã€‘', x: -2800, y: 1500, level: 4, parent: 'n25', newsId: 'article_013' },
                { id: 'n44', text: 'ã€44ã€‘', x: -2400, y: 1500, level: 4, parent: 'n25', newsId: 'article_044' },
                // äº”å±‚èŠ‚ç‚¹ï¼ˆn3ä¸‹ï¼‰
                { id: 'n42', text: 'ã€42ã€‘', x: -3200, y: 2000, level: 5, parent: 'n5', newsId: 'article_042' },
                // ä¸‰å±‚èŠ‚ç‚¹ï¼ˆn4ä¸‹ï¼‰
                { id: 'n26', text: 'ã€26ã€‘', x: -4200, y: 1000, level: 3, parent: 'n4', newsId: 'article_026' },
                // å››å±‚èŠ‚ç‚¹ï¼ˆn4ä¸‹ï¼‰
                { id: 'n38', text: 'ã€38ã€‘', x: -4400, y: 1500, level: 4, parent: 'n26', newsId: 'article_038' },
                { id: 'n47', text: 'ã€47ã€‘', x: -4000, y: 1500, level: 4, parent: 'n26', newsId: 'article_047' },
                // ä¸‰å±‚èŠ‚ç‚¹ï¼ˆn27ä¸‹ï¼‰
                { id: 'n39', text: 'ã€39ã€‘', x: -3600, y: 1000, level: 3, parent: 'n27', newsId: 'article_039' },
                // ç¬¬äºŒå±‚èŠ‚ç‚¹ï¼ˆroot2ä¸‹ï¼‰
                { id: 'n15', text: 'ã€15ã€‘', x: -1200, y: 500, level: 2, parent: 'root2', newsId: 'article_015' },
                { id: 'n16', text: 'ã€16ã€‘', x: -600, y: 500, level: 2, parent: 'root2', newsId: 'article_016' },
                // ä¸‰å±‚èŠ‚ç‚¹ï¼ˆroot2ä¸‹ï¼‰
                { id: 'n35', text: 'ã€35ã€‘', x: -1200, y: 1000, level: 3, parent: 'n15', newsId: 'article_035' },
                // å››å±‚èŠ‚ç‚¹ï¼ˆroot2ä¸‹ï¼‰
                { id: 'n34', text: 'ã€34ã€‘', x: -1200, y: 1500, level: 4, parent: 'n35', newsId: 'article_034' },
                // ç¬¬äºŒå±‚èŠ‚ç‚¹ï¼ˆroot3ä¸‹ï¼‰
                { id: 'n12', text: 'ã€12ã€‘', x: 0, y: 500, level: 2, parent: 'root3', newsId: 'article_012' },
                // ä¸‰å±‚èŠ‚ç‚¹ï¼ˆroot3ä¸‹ï¼‰
                { id: 'n11', text: 'ã€11ã€‘', x: -400, y: 1000, level: 3, parent: 'n12', newsId: 'article_011' },
                { id: 'n37', text: 'ã€37ã€‘', x: 400, y: 1000, level: 3, parent: 'n12', newsId: 'article_037' },
                // å››å±‚èŠ‚ç‚¹ï¼ˆroot3ä¸‹ï¼‰
                { id: 'n14', text: 'ã€14ã€‘', x: 0, y: 1500, level: 4, parent: 'n37', newsId: 'article_014' },
                { id: 'n24', text: 'ã€24ã€‘', x: 400, y: 1500, level: 4, parent: 'n37', newsId: 'article_024' },
                { id: 'n40', text: 'ã€40ã€‘', x: 800, y: 1500, level: 4, parent: 'n37', newsId: 'article_040' },
                // äº”å±‚èŠ‚ç‚¹ï¼ˆroot3ä¸‹ï¼‰
                { id: 'n46', text: 'ã€46ã€‘', x: 400, y: 2000, level: 5, parent: 'n24', newsId: 'article_046' },
                // ç¬¬äºŒå±‚èŠ‚ç‚¹ï¼ˆroot4ä¸‹ï¼‰
                { id: 'n18', text: 'ã€18ã€‘', x: 1200, y: 500, level: 2, parent: 'root4', newsId: 'article_018' },
                // ç¬¬äºŒå±‚èŠ‚ç‚¹ï¼ˆroot5ä¸‹ï¼‰
                { id: 'n22', text: 'ã€22ã€‘', x: 2400, y: 500, level: 2, parent: 'root5', newsId: 'article_022' },
                // ç¬¬äºŒå±‚èŠ‚ç‚¹ï¼ˆroot6ä¸‹ï¼‰
                { id: 'n1', text: 'ã€1ã€‘', x: 3600, y: 500, level: 2, parent: 'root6', newsId: 'article_001' },
                // ä¸‰å±‚èŠ‚ç‚¹ï¼ˆroot6ä¸‹ï¼‰
                { id: 'n29', text: 'ã€29ã€‘', x: 3200, y: 1000, level: 3, parent: 'n1', newsId: 'article_029' },
                { id: 'n45', text: 'ã€45ã€‘', x: 3800, y: 1000, level: 3, parent: 'n1', newsId: 'article_045' },
                // ç¬¬äºŒå±‚èŠ‚ç‚¹ï¼ˆroot7ä¸‹ï¼‰
                { id: 'n8', text: 'ã€8ã€‘', x: 4300, y: 500, level: 2, parent: 'root7', newsId: 'article_008' },
                { id: 'n17', text: 'ã€17ã€‘', x: 4800, y: 500, level: 2, parent: 'root7', newsId: 'article_017' },
                { id: 'n23', text: 'ã€23ã€‘', x: 5300, y: 500, level: 2, parent: 'root7', newsId: 'article_023' },
                // ä¸‰å±‚èŠ‚ç‚¹ï¼ˆroot7ä¸‹ï¼‰
                { id: 'n9', text: 'ã€9ã€‘', x: 4300, y: 1000, level: 3, parent: 'n8', newsId: 'article_009' },
                // å››å±‚èŠ‚ç‚¹ï¼ˆroot7ä¸‹ï¼‰
                { id: 'n41', text: 'ã€41ã€‘', x: 4300, y: 1500, level: 4, parent: 'n9', newsId: 'article_041' },
                { id: 'n48', text: 'ã€48ã€‘', x: 4800, y: 1500, level: 4, parent: 'n9', newsId: 'article_048' },
                { id: 'n49', text: 'ã€49ã€‘', x: 5200, y: 1500, level: 4, parent: 'n9', newsId: 'article_049' },
            ],
            connections: [
                ['start', 'root1'], ['start', 'root2'], ['start', 'root3'], 
                ['start', 'root4'], ['start', 'root5'], ['start', 'root6'], ['start', 'root7'],
                ['root1', 'n2'], ['root1', 'n3'], ['root1', 'n4'], ['root1', 'n6'], 
                ['root1', 'n30'], ['root1', 'n27'], ['root1', 'n31'],['root1', 'n50'],
                ['n2', 'n7'], ['n2', 'n10'], ['n2', 'n19'], ['n2', 'n21'], ['n2', 'n33'], ['n2', 'n36'],
                ['n7', 'n43'],
                ['n10', 'n20'], ['n10', 'n28'], ['n10', 'n32'],
                ['n31', 'n19'],
                ['n3', 'n25'],
                ['n25', 'n5'], ['n25', 'n13'], ['n25', 'n44'],
                ['n5', 'n42'],
                ['n4', 'n26'],
                ['n26', 'n38'], ['n26', 'n47'],
                ['n27', 'n39'],
                ['root2', 'n15'], ['root2', 'n16'],
                ['n15', 'n35'],
                ['n35', 'n34'],
                ['root3', 'n12'],
                ['n12', 'n11'], ['n12', 'n37'],
                ['n37', 'n14'], ['n37', 'n24'], ['n37', 'n40'],
                ['n24', 'n46'],
                ['root4', 'n18'],
                ['n18', 'n6'],
                ['root5', 'n22'],
                ['root6', 'n1'],
                ['n1', 'n29'], ['n1', 'n45'],
                ['n29', 'n8'], ['n29', 'n17'], ['n29', 'n23'],
                ['n8', 'n9'],
                ['n9', 'n41'], ['n9', 'n48'], ['n9', 'n49'],
                ['root7', 'n8'], ['root7', 'n17'], ['root7', 'n23']
            ]
        };

        // ==================== æ¸¸æˆçŠ¶æ€ç®¡ç† ====================
        const GameState = {
            STORAGE_KEY: 'news_game_state',

            getState() {
                try {
                    const saved = localStorage.getItem(this.STORAGE_KEY);
                    if (saved) return JSON.parse(saved);
                } catch (e) {
                    console.error('è¯»å–å­˜æ¡£å¤±è´¥:', e);
                }
                return {
                    unlockedArticles: ['article_001'],
                    discoveredClues: [],
                    searchHistory: [],
                    mindMapScale: 1
                };
            },

            saveState(state) {
                try {
                    localStorage.setItem(this.STORAGE_KEY, JSON.stringify(state));
                } catch (e) {
                    console.error('ä¿å­˜å­˜æ¡£å¤±è´¥:', e);
                }
            },

            unlockArticle(articleId) {
                const state = this.getState();
                if (!state.unlockedArticles.includes(articleId)) {
                    state.unlockedArticles.push(articleId);
                    this.saveState(state);
                    return true;
                }
                return false;
            },

            isUnlocked(articleId) {
                return this.getState().unlockedArticles.includes(articleId);
            },

            addSearchHistory(keyword) {
                const state = this.getState();
                if (!state.searchHistory.includes(keyword)) {
                    state.searchHistory.push(keyword);
                    this.saveState(state);
                }
            },

            getSearchHistory() {
                return this.getState().searchHistory;
            },

            // æ–°å¢ï¼šå¯¼å‡ºæ¸¸æˆè¿›åº¦
            exportState() {
                return JSON.stringify(this.getState(), null, 2);
            },

            // é‡ç½®å­˜æ¡£
            resetState() {
                localStorage.setItem(this.STORAGE_KEY, JSON.stringify({
                    unlockedArticles: ['article_001'],
                    discoveredClues: [],
                    searchHistory: [],
                    mindMapScale: 1
                }));
            },

            // å¯¼å…¥å­˜æ¡£
            importState(jsonStr) {
                try {
                    const parsed = JSON.parse(jsonStr);
                    if (parsed && Array.isArray(parsed.unlockedArticles)) {
                        localStorage.setItem(this.STORAGE_KEY, jsonStr);
                        return true;
                    }
                } catch (e) {
                    console.error('å¯¼å…¥å¤±è´¥', e);
                }
                return false;
            }
        };

        // ==================== æ–°å¢ï¼šå¯¼å‡ºæ¸¸æˆè¿›åº¦å‡½æ•° ====================
        function exportGameProgress() {
            const stateStr = GameState.exportState();
            const blob = new Blob([stateStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `news_game_save_${new Date().toISOString().slice(0, 10)}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // ==================== æ ¸å¿ƒåŠŸèƒ½ ====================
        function init() {
            resizeCanvas();
            window.addEventListener('resize', resizeCanvas);

            // åŠ è½½æ–°é—»æ•°æ®
            loadNewsData().then(() => {
                // åˆ›å»ºåˆå§‹èŠ‚ç‚¹ - æ ¹æ®è§£é”çŠ¶æ€å†³å®šæ˜¾ç¤ºå†…å®¹
                initialData.nodes.forEach(nodeData => {
                    // å¦‚æœæ˜¯æ–°é—»èŠ‚ç‚¹ä¸”æœªè§£é”ï¼Œæ˜¾ç¤ºä¸ºæœªçŸ¥èŠ‚ç‚¹
                    if (nodeData.newsId && !GameState.isUnlocked(nodeData.newsId)) {
                        createNodeElement({
                            ...nodeData,
                            text: 'æœªçŸ¥çº¿ç´¢',
                            isUnknown: true
                        });
                    } else if (nodeData.newsId && GameState.isUnlocked(nodeData.newsId)) {
                        // å·²è§£é”çš„æ–°é—»èŠ‚ç‚¹ï¼Œåªæ˜¾ç¤ºç¼–å·ï¼Œæ ¼å¼ä¸ºã€001ã€‘
                        const number = nodeData.newsId.replace('article_0', '');
                        createNodeElement({
                            ...nodeData,
                            text: 'ã€' + number + 'ã€‘',
                            isUnlocked: true
                        });
                    } else {
                        createNodeElement(nodeData);
                    }
                });

                // åˆ›å»ºè¿æ¥
                initialData.connections.forEach(([from, to]) => {
                    connections.push({ from, to });
                });

                centerView();
                updateStats();
                drawGrid();
                drawConnections();
            });

            setupEventListeners();
            updateHistoryDisplay();
        }

        async function loadNewsData() {
            try {
                const response = await fetch('./news_database.json');
                if (!response.ok) throw new Error('æ— æ³•åŠ è½½æ•°æ®');
                newsDatabase = await response.json();
                console.log('æ–°é—»æ•°æ®åŠ è½½æˆåŠŸ');
                return true;
            } catch (error) {
                console.error('åŠ è½½å¤±è´¥:', error);
                return false;
            }
        }

        function resizeCanvas() {
            const rect = container.getBoundingClientRect();
            connCanvas.width = rect.width;
            connCanvas.height = rect.height;
            drawConnections();
        }

        function createNodeElement(data, isClue = false) {
            const node = document.createElement('div');
            node.className = `node level-${data.level}`;
            if (isClue) node.classList.add('clue-node');

            // å¦‚æœæ˜¯æ–°é—»èŠ‚ç‚¹ï¼Œæ·»åŠ news-nodeç±»å’Œç‚¹å‡»äº‹ä»¶
            if (data.newsId) {
                node.classList.add('news-node');
                node.dataset.newsId = data.newsId;

                // å¦‚æœæœªè§£é”ï¼Œæ·»åŠ æœªçŸ¥èŠ‚ç‚¹æ ·å¼
                if (data.isUnknown) {
                    node.classList.add('unknown-node');
                } else if (data.isUnlocked) {
                    node.classList.add('unlocked');
                }
            }

            node.id = data.id;
            node.textContent = data.text;

            node.dataset.x = data.x;
            node.dataset.y = data.y;
            node.dataset.isClue = isClue ? 'true' : 'false';

            updateNodePosition(node, data.x, data.y);

            node.addEventListener('mousedown', handleNodeDown);
            node.addEventListener('click', handleNodeClick);
            node.addEventListener('dblclick', handleNodeDblClick);
            node.addEventListener('contextmenu', showContextMenu);

            nodeLayer.appendChild(node);
            nodes.push({ ...data, element: node, isClue: isClue });
            return node;
        }

        function worldToScreen(x, y) {
            return { 
                x: (x - offsetX) * scale + container.clientWidth / 2, 
                y: (y - offsetY) * scale + container.clientHeight / 2 
            };
        }

        function screenToWorld(sx, sy) {
            return { 
                x: (sx - container.clientWidth / 2) / scale + offsetX, 
                y: (sy - container.clientHeight / 2) / scale + offsetY 
            };
        }

        function updateNodePosition(node, x, y) {
            const pos = worldToScreen(x, y);
            node.style.left = pos.x + 'px';
            node.style.top = pos.y + 'px';
            node.style.transform = `translate(-50%, -50%)`;
        }

        function createConnection(fromId, toId) {
            connections.push({ from: fromId, to: toId });
        }

        function drawGrid() {
            const offsetXScreen = (-offsetX * scale + container.clientWidth / 2) % (CONFIG.gridSize * scale);
            const offsetYScreen = (-offsetY * scale + container.clientHeight / 2) % (CONFIG.gridSize * scale);
            grid.style.backgroundPosition = `${offsetXScreen}px ${offsetYScreen}px`;
        }

        function drawConnections() {
            const ctx = connCtx;
            const w = connCanvas.width;
            const h = connCanvas.height;

            ctx.clearRect(0, 0, w, h);

            connections.forEach(conn => {
                const fromNode = nodes.find(n => n.id === conn.from);
                const toNode = nodes.find(n => n.id === conn.to);
                if (!fromNode || !toNode) return;

                const fromX = parseFloat(fromNode.element.dataset.x);
                const fromY = parseFloat(fromNode.element.dataset.y);
                const toX = parseFloat(toNode.element.dataset.x);
                const toY = parseFloat(toNode.element.dataset.y);

                const fromPos = worldToScreen(fromX, fromY);
                const toPos = worldToScreen(toX, toY);

                const isSelected = selectedNodes.includes(conn.from) || selectedNodes.includes(conn.to);

                ctx.beginPath();
                ctx.moveTo(fromPos.x, fromPos.y);
                ctx.lineTo(toPos.x, toPos.y);

                ctx.strokeStyle = isSelected ? '#ff0040' : '#2a2a2a';
                ctx.lineWidth = isSelected ? 3 : 2;
                ctx.lineCap = 'round';
                ctx.stroke();
            });
        }

        function getEdgePoint(cx, cy, tx, ty, hw, hh) {
            const dx = tx - cx;
            const dy = ty - cy;
            if (Math.abs(dx) < 0.001 && Math.abs(dy) < 0.001) return { x: cx, y: cy };
            const absTan = Math.abs(dy / dx);
            const rectTan = hh / hw;
            if (absTan < rectTan) {
                return { x: cx + Math.sign(dx) * hw, y: cy + dy * hw / Math.abs(dx) };
            } else {
                return { x: cx + dx * hh / Math.abs(dy), y: cy + Math.sign(dy) * hh };
            }
        }

        // ==================== äº¤äº’ ====================
        function handleNodeDown(e) {
    if (connectMode || mergeMode) {
        e.stopPropagation();
        e.preventDefault();
        return;
    }
    e.stopPropagation();
    e.preventDefault();
    
    const node = e.currentTarget;
    
    // è®°å½•æŒ‰ä¸‹æ—¶çš„ä½ç½®ï¼Œç”¨äºæ£€æµ‹æ˜¯å¦ä¸ºçœŸå®æ‹–æ‹½
    const startX = e.clientX;
    const startY = e.clientY;
    
    // è·å–èŠ‚ç‚¹çš„å½“å‰ä¸–ç•Œåæ ‡
    const worldX = parseFloat(node.dataset.x);
    const worldY = parseFloat(node.dataset.y);
    
    // å°†ä¸–ç•Œåæ ‡è½¬æ¢ä¸ºå±å¹•åæ ‡ï¼ˆèŠ‚ç‚¹ä¸­å¿ƒä½ç½®ï¼‰
    const screenPos = worldToScreen(worldX, worldY);
    
    // è®¡ç®—é¼ æ ‡ç›¸å¯¹äºèŠ‚ç‚¹ä¸­å¿ƒçš„åç§»ï¼ˆå±å¹•åæ ‡ï¼‰
    dragOffset.x = screenPos.x - startX;
    dragOffset.y = screenPos.y - startY;
    
    // è®¾ç½®ä¸€ä¸ªæ‹–æ‹½é˜ˆå€¼ï¼Œåªæœ‰ç§»åŠ¨è¶…è¿‡ä¸€å®šè·ç¦»æ‰è®¤ä¸ºæ˜¯æ‹–æ‹½
    const dragThreshold = 5;
    let dragStarted = false;
    
    const onMouseMove = (moveEvent) => {
        const dx = Math.abs(moveEvent.clientX - startX);
        const dy = Math.abs(moveEvent.clientY - startY);
        
        if (dx > dragThreshold || dy > dragThreshold) {
            if (!dragStarted) {
                dragStarted = true;
                isDragging = true;
                dragNode = node;
                node.classList.add('dragging');
                nodeLayer.classList.add('dragging-node');
            }
            
            if (dragStarted) {
                // è®¡ç®—èŠ‚ç‚¹åº”è¯¥å‡ºç°çš„å±å¹•ä½ç½®ï¼šé¼ æ ‡ä½ç½® + åç§»é‡
                const targetScreenX = moveEvent.clientX + dragOffset.x;
                const targetScreenY = moveEvent.clientY + dragOffset.y;
                
                // è½¬æ¢ä¸ºä¸–ç•Œåæ ‡
                const worldPos = screenToWorld(targetScreenX, targetScreenY);
                
                // æ›´æ–°èŠ‚ç‚¹çš„æ•°æ®åæ ‡
                node.dataset.x = worldPos.x;
                node.dataset.y = worldPos.y;
                
                // ç›´æ¥è®¾ç½®CSSä½ç½®ï¼ˆé¿å…å†æ¬¡é€šè¿‡worldToScreenè®¡ç®—ï¼Œé˜²æ­¢ç´¯ç§¯è¯¯å·®ï¼‰
                node.style.left = targetScreenX + 'px';
                node.style.top = targetScreenY + 'px';
                
                drawConnections();
                
                // æ£€æŸ¥æ˜¯å¦åœ¨åˆ é™¤åŒºåŸŸ
                const trashZone = document.getElementById('trash-zone');
                if (moveEvent.clientY > window.innerHeight - 100) {
                    trashZone.classList.add('active');
                } else {
                    trashZone.classList.remove('active');
                }
            }
        }
    };
    
    const onMouseUp = () => {
        document.removeEventListener('mousemove', onMouseMove);
        document.removeEventListener('mouseup', onMouseUp);
        
        if (dragStarted) {
            // ç¡®ä¿æœ€ç»ˆä½ç½®æ­£ç¡®
            const finalScreenX = dragNode ? parseFloat(dragNode.style.left) : 0;
            const finalScreenY = dragNode ? parseFloat(dragNode.style.top) : 0;
            
            if (dragNode && finalScreenY > window.innerHeight - 100) {
                // åˆ é™¤èŠ‚ç‚¹é€»è¾‘
                const nodeId = dragNode.id;
                dragNode.remove();
                nodes = nodes.filter(n => n.id !== nodeId);
                connections = connections.filter(c => c.from !== nodeId && c.to !== nodeId);
                selectedNodes = selectedNodes.filter(id => id !== nodeId);
            } else {
                // å°†æœ€ç»ˆå±å¹•åæ ‡è½¬æ¢å›ä¸–ç•Œåæ ‡å¹¶ä¿å­˜
                const finalWorldPos = screenToWorld(finalScreenX, finalScreenY);
                if (dragNode) {
                    dragNode.dataset.x = finalWorldPos.x;
                    dragNode.dataset.y = finalWorldPos.y;
                    // ä½¿ç”¨updateNodePositionç¡®ä¿ä½ç½®æ­£ç¡®ï¼ˆå®ƒä¼šåº”ç”¨å½“å‰çš„scaleå’Œoffsetï¼‰
                    updateNodePosition(dragNode, finalWorldPos.x, finalWorldPos.y);
                }
            }
            
            if (dragNode) {
                dragNode.classList.remove('dragging');
            }
            nodeLayer.classList.remove('dragging-node');
            isDragging = false;
            dragNode = null;
            document.getElementById('trash-zone').classList.remove('active');
            drawConnections();
            updateStats();
        } else {
            // å¦‚æœæ²¡æœ‰è§¦å‘æ‹–æ‹½ï¼Œæ‰§è¡Œç‚¹å‡»é€»è¾‘
            handleNodeClick(e);
        }
    };
    
    document.addEventListener('mousemove', onMouseMove);
    document.addEventListener('mouseup', onMouseUp);
}

        function handleNodeClick(e) {
            const node = e.currentTarget;
            const nodeId = node.id;

            // è¿æ¥æ¨¡å¼
            if (connectMode) {
                e.stopPropagation();
                if (!connectStart) {
                    connectStart = nodeId;
                    node.classList.add('selected');
                    updateStatus('è¿æ¥æ¨¡å¼ï¼šé€‰æ‹©ç¬¬äºŒä¸ªèŠ‚ç‚¹');
                } else if (connectStart !== nodeId) {
                    createConnection(connectStart, nodeId);
                    document.querySelectorAll('.node.selected').forEach(n => n.classList.remove('selected'));
                    connectStart = null;
                    drawConnections();
                    updateStats();
                    updateStatus('è¿æ¥å·²åˆ›å»º');
                }
                return;
            }

            // åˆå¹¶æ¨¡å¼
            if (mergeMode) {
                e.stopPropagation();
                if (!mergeStart) {
                    mergeStart = nodeId;
                    node.classList.add('selected');
                    updateStatus('åˆå¹¶æ¨¡å¼ï¼šé€‰æ‹©ç¬¬äºŒä¸ªèŠ‚ç‚¹');
                } else if (mergeStart !== nodeId) {
                    tryMerge(mergeStart, nodeId);
                    document.querySelectorAll('.node.selected').forEach(n => n.classList.remove('selected'));
                    mergeStart = null;
                    updateStatus('');
                }
                return;
            }

            // æ™®é€šç‚¹å‡» - æ£€æŸ¥æ˜¯å¦æ˜¯æ–°é—»èŠ‚ç‚¹
            if (node.dataset.newsId) {
                const newsId = node.dataset.newsId;
                // æ£€æŸ¥æ˜¯å¦å·²è§£é”
                if (GameState.isUnlocked(newsId)) {
                    openNewsDetail(newsId);
                } else {
                    // æœªè§£é”ï¼Œæç¤ºç”¨æˆ·
                    alert('è¯¥æ–°é—»å°šæœªè§£é”ï¼Œè¯·é€šè¿‡æœç´¢ç›¸å…³å…³é”®è¯è§£é”ã€‚');
                }
                return;
            }

            // Shiftå¤šé€‰
            if (e.shiftKey) {
                e.stopPropagation();
                if (selectedNodes.includes(nodeId)) {
                    selectedNodes = selectedNodes.filter(id => id !== nodeId);
                    node.classList.remove('selected');
                } else {
                    selectedNodes.push(nodeId);
                    node.classList.add('selected');
                }
                drawConnections();
                updateStats();
                return;
            }

            // æ™®é€šé€‰æ‹©
            if (!isDragging) {
                document.querySelectorAll('.node.selected').forEach(n => n.classList.remove('selected'));
                selectedNodes = [nodeId];
                node.classList.add('selected');
                drawConnections();
                updateStats();
            }
        }

        function handleNodeDblClick(e) {
            const node = e.currentTarget;
            const currentText = node.textContent;
            const input = document.createElement('input');
            input.value = currentText;
            node.innerHTML = '';
            node.appendChild(input);
            input.focus();
            input.select();

            const saveEdit = () => {
                const newText = input.value.trim() || currentText;
                node.textContent = newText;
                const nodeData = nodes.find(n => n.id === node.id);
                if (nodeData) nodeData.text = newText;
            };

            input.addEventListener('blur', saveEdit);
            input.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    saveEdit();
                }
            });
        }

        function showContextMenu(e) {
            e.preventDefault();
            const menu = document.getElementById('contextMenu');
            const node = e.currentTarget;

            if (!selectedNodes.includes(node.id)) {
                document.querySelectorAll('.node.selected').forEach(n => n.classList.remove('selected'));
                selectedNodes = [node.id];
                node.classList.add('selected');
                drawConnections();
                updateStats();
            }

            menu.style.display = 'block';
            menu.style.left = e.pageX + 'px';
            menu.style.top = e.pageY + 'px';

            // æ›´æ–°"æŸ¥çœ‹æ–°é—»"èœå•é¡¹çš„æ˜¾ç¤ºçŠ¶æ€
            const viewNewsItem = menu.querySelector('[onclick="openNewsFromContext()"]');
            if (viewNewsItem) {
                if (node.dataset.newsId && GameState.isUnlocked(node.dataset.newsId)) {
                    viewNewsItem.style.display = 'flex';
                    viewNewsItem.classList.remove('disabled');
                } else {
                    viewNewsItem.style.display = 'none';
                }
            }

            const mergeBtn = document.getElementById('contextMergeBtn');
            if (selectedNodes.length === 2) {
                mergeBtn.classList.remove('disabled');
            } else {
                mergeBtn.classList.add('disabled');
            }
        }

        function hideContextMenu() {
            document.getElementById('contextMenu').style.display = 'none';
        }

        // ==================== æ–°é—»ç›¸å…³åŠŸèƒ½ ====================
        function openNewsDetail(newsId) {
            window.open(`news_detail.html?id=${newsId}`, '_blank');
        }

        function openNewsFromContext() {
            const node = document.querySelector('.node.selected');
            if (node && node.dataset.newsId && GameState.isUnlocked(node.dataset.newsId)) {
                openNewsDetail(node.dataset.newsId);
            }
            hideContextMenu();
        }

        function performSearch() {
            const keyword = document.getElementById('searchInput').value.trim();
            if (!keyword || !newsDatabase) return;

            // ä¿å­˜åˆ°å†å²
            GameState.addSearchHistory(keyword);

            // æŸ¥æ‰¾ç»“æœ
            const results = newsDatabase.search_index[keyword] || [];
            const uniqueResults = [...new Set(results)];

            // è§£é”æ–‡ç« 
            const newUnlocks = [];
            uniqueResults.forEach(id => {
                if (GameState.unlockArticle(id)) {
                    newUnlocks.push(id);
                }
            });

            // æ˜¾ç¤ºç»“æœ
            displayResults(keyword, uniqueResults, newUnlocks);

            // æ›´æ–°å†å²æ˜¾ç¤º
            updateHistoryDisplay();

            // æ›´æ–°æ€ç»´å¯¼å›¾ä¸­å¯¹åº”çš„èŠ‚ç‚¹ï¼šå°†æ–°è§£é”çš„æœªçŸ¥èŠ‚ç‚¹æ›¿æ¢ä¸ºç¼–å·èŠ‚ç‚¹
            newUnlocks.forEach(id => {
                const nodeElement = document.querySelector(`.node[data-news-id="${id}"]`);
                if (nodeElement) {
                    const number = id.replace('article_', '');
                    nodeElement.textContent = 'ã€' + number + 'ã€‘';
                    nodeElement.classList.remove('unknown-node');
                    nodeElement.classList.add('unlocked');
                }
            });

            // é«˜äº®æ€ç»´å¯¼å›¾ä¸­å¯¹åº”çš„èŠ‚ç‚¹
            highlightNewsNodes(uniqueResults);
        }

        function displayResults(keyword, results, newUnlocks) {
            const container = document.getElementById('searchResults');

            if (results.length === 0) {
                container.innerHTML = `
                    <div class="no-results">
                        <p>æœªæ‰¾åˆ°ä¸ "${keyword}" ç›¸å…³çš„æ–°é—»</p>
                        <p style="font-size: 12px; color: #999;">å°è¯•å…¶ä»–å…³é”®è¯...</p>
                    </div>
                `;
                return;
            }

            let html = `<div style="margin-bottom: 10px; color: #666; font-size: 13px;">"${keyword}" æ‰¾åˆ° ${results.length} æ¡ç»“æœ:</div>`;

            results.forEach(id => {
                const article = newsDatabase.articles[id];
                const isNew = newUnlocks.includes(id);

                html += `
                    <div class="result-item ${isNew ? 'new' : ''}" onclick="openNewsDetail('${id}')">
                        <div class="result-title">${isNew ? 'ğŸ”“ ' : ''}${article.title}</div>
                        <div class="result-meta">${article.date} | ${article.section}</div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        function highlightNewsNodes(articleIds) {
            // æ¸…é™¤ä¹‹å‰çš„é«˜äº®
            document.querySelectorAll('.node').forEach(node => {
                node.style.boxShadow = '';
            });

            // é«˜äº®åŒ¹é…çš„èŠ‚ç‚¹
            articleIds.forEach(id => {
                const node = document.querySelector(`.node[data-news-id="${id}"]`);
                if (node) {
                    node.style.boxShadow = '0 0 20px #ff0040, 4px 4px 0 rgba(0,0,0,0.3)';
                }
            });
        }

        function updateHistoryDisplay() {
            const history = GameState.getSearchHistory();
            const section = document.getElementById('historySection');
            const tags = document.getElementById('historyTags');

            if (history.length === 0) {
                section.style.display = 'none';
                return;
            }

            section.style.display = 'block';
            tags.innerHTML = history.map(k => 
                `<span class="history-tag" onclick="document.getElementById('searchInput').value='${k}';performSearch()">${k}</span>`
            ).join('');
        }

        // ==================== åˆå¹¶åŠŸèƒ½ ====================
        function tryMerge(node1Id, node2Id) {
            const rule = MERGE_RULES.find(r => 
                (r.sources[0] === node1Id && r.sources[1] === node2Id) ||
                (r.sources[0] === node2Id && r.sources[1] === node1Id)
            );

            if (rule) {
                const node1 = nodes.find(n => n.id === node1Id);
                const node2 = nodes.find(n => n.id === node2Id);

                const avgX = (parseFloat(node1.element.dataset.x) + parseFloat(node2.element.dataset.x)) / 2;
                const avgY = (parseFloat(node1.element.dataset.y) + parseFloat(node2.element.dataset.y)) / 2;

                const clueNode = createNodeElement({
                    id: rule.id,
                    text: 'ğŸ’¡ ' + rule.result.substring(0, 20) + (rule.result.length > 20 ? '...' : ''),
                    x: avgX,
                    y: avgY - 100,
                    level: 3
                }, true);

                createConnection(node1Id, rule.id);
                createConnection(node2Id, rule.id);

                addClueToPanel(rule.result, rule.id);

                if (rule.nextStep) {
                    setTimeout(() => {
                        tryMerge(rule.id, rule.nextStep.sources[1]);
                    }, 500);
                }

                drawConnections();
                updateStats();

                clueCounter++;
                checkFinalClues();

                return true;
            }
            return false;
        }

        function tryMergeFromContext() {
            if (selectedNodes.length === 2) {
                const success = tryMerge(selectedNodes[0], selectedNodes[1]);
                if (!success) {
                    alert('è¿™ä¸¤ä¸ªèŠ‚ç‚¹æ— æ³•åˆå¹¶ï¼Œè¯·å°è¯•å…¶ä»–ç»„åˆã€‚');
                }
            }
            hideContextMenu();
        }

        function addClueToPanel(clueText, clueId) {
            if (discoveredClues.includes(clueId)) return;
            discoveredClues.push(clueId);

            const clueList = document.getElementById('clue-list');
            const clueItem = document.createElement('div');
            clueItem.className = 'clue-item';
            clueItem.innerHTML = `<strong>çº¿ç´¢ #${discoveredClues.length}:</strong> ${clueText}`;
            clueList.appendChild(clueItem);

            updateStats();
        }

        function checkFinalClues() {
            if (clueCounter >= TOTAL_CLUES && !finalCluesShown) {
                finalCluesShown = true;
                showFinalClues();
            }
        }

        function showFinalClues() {
            const panel = document.getElementById('final-clue-panel');
            const list = document.getElementById('final-clue-list');

            list.innerHTML = `
                <div class="final-clue-item">
                    <h4>ğŸ” ç»ˆæå¯†ç å·²ç ´è§£</h4>
                    <p>æ­å–œï¼æ‚¨å·²å‘ç°æ‰€æœ‰çº¿ç´¢ï¼ŒæˆåŠŸè¿˜åŸæ¡ˆä»¶çœŸç›¸ã€‚</p>
                    <div class="password-list">
                        <span class="password-tag">çœŸç›¸å¤§ç™½</span>
                    </div>
                </div>
            `;

            panel.classList.add('active');
        }

        // ==================== å·¥å…·åŠŸèƒ½ ====================
        function addNode() {
            const newNode = createNodeElement({
                id: 'n' + (++nodeIdCounter),
                text: 'æ–°èŠ‚ç‚¹',
                x: offsetX,
                y: offsetY,
                level: 2
            });
            updateStats();
        }

        function toggleConnectMode() {
            connectMode = !connectMode;
            mergeMode = false;
            connectStart = null;
            document.getElementById('connectBtn').classList.toggle('active', connectMode);
            document.getElementById('mergeBtn').classList.remove('active');
            document.getElementById('modeIndicator').classList.toggle('active', connectMode);
            document.getElementById('modeIndicator').textContent = 'è¿æ¥æ¨¡å¼ï¼šç‚¹å‡»ä¸¤ä¸ªèŠ‚ç‚¹åˆ›å»ºè¿æ¥';
            document.getElementById('merge-hint').classList.remove('active');
            document.querySelectorAll('.node.selected').forEach(n => n.classList.remove('selected'));
            selectedNodes = [];
            updateStats();
        }

        function toggleMergeMode() {
            mergeMode = !mergeMode;
            connectMode = false;
            mergeStart = null;
            document.getElementById('mergeBtn').classList.toggle('active', mergeMode);
            document.getElementById('connectBtn').classList.remove('active');
            document.getElementById('modeIndicator').classList.toggle('active', mergeMode);
            document.getElementById('modeIndicator').textContent = 'åˆå¹¶æ¨¡å¼ï¼šé€‰æ‹©ä¸¤ä¸ªèŠ‚ç‚¹è¿›è¡Œçº¿ç´¢åˆå¹¶';
            document.getElementById('merge-hint').classList.toggle('active', mergeMode);
            document.querySelectorAll('.node.selected').forEach(n => n.classList.remove('selected'));
            selectedNodes = [];
            updateStats();
        }

        function deleteSelected() {
            selectedNodes.forEach(nodeId => {
                const nodeEl = document.getElementById(nodeId);
                if (nodeEl) nodeEl.remove();
                nodes = nodes.filter(n => n.id !== nodeId);
                connections = connections.filter(c => c.from !== nodeId && c.to !== nodeId);
            });
            selectedNodes = [];
            drawConnections();
            updateStats();
            hideContextMenu();
        }

        function toggleBookmark() {
            selectedNodes.forEach(nodeId => {
                const node = document.getElementById(nodeId);
                if (node) node.classList.toggle('bookmarked');
            });
            hideContextMenu();
        }

        function toggleUnknown() {
            selectedNodes.forEach(nodeId => {
                const node = document.getElementById(nodeId);
                if (node) node.classList.toggle('unknown-node');
            });
            hideContextMenu();
        }

        function toggleCluePanel() {
            document.getElementById('clue-panel').classList.toggle('active');
        }

        function editNode() {
            if (selectedNodes.length === 1) {
                const node = document.getElementById(selectedNodes[0]);
                if (node) handleNodeDblClick({ currentTarget: node });
            }
            hideContextMenu();
        }

        function zoomIn() {
            scale = Math.min(CONFIG.scaleMax, scale + CONFIG.zoomStep);
            updateTransform();
        }

        function zoomOut() {
            scale = Math.max(CONFIG.scaleMin, scale - CONFIG.zoomStep);
            updateTransform();
        }

        function resetView() {
            scale = 0.3;
            centerView();
        }

        function centerView() {
            if (nodes.length === 0) return;

            let minX = Infinity, maxX = -Infinity, minY = Infinity, maxY = -Infinity;
            nodes.forEach(node => {
                const x = parseFloat(node.element.dataset.x);
                const y = parseFloat(node.element.dataset.y);
                minX = Math.min(minX, x);
                maxX = Math.max(maxX, x);
                minY = Math.min(minY, y);
                maxY = Math.max(maxY, y);
            });

            offsetX = (minX + maxX) / 2;
            offsetY = (minY + maxY) / 2;

            updateTransform();
        }

        function updateTransform() {
            nodes.forEach(node => {
                updateNodePosition(node.element, parseFloat(node.element.dataset.x), parseFloat(node.element.dataset.y));
            });
            drawGrid();
            drawConnections();
            updateStats();
        }

        function updateStats() {
            const clueCount = document.querySelectorAll('.node.clue-node').length;
            document.getElementById('statNodes').textContent = nodes.length;
            document.getElementById('statConnections').textContent = connections.length;
            document.getElementById('statClues').textContent = clueCount;
            document.getElementById('statSelected').textContent = selectedNodes.length;
            document.getElementById('statusText').textContent = 
                `å°±ç»ª - èŠ‚ç‚¹æ•°: ${nodes.length} | è¿æ¥æ•°: ${connections.length} | çº¿ç´¢: ${clueCount} | é€‰ä¸­: ${selectedNodes.length} | ç¼©æ”¾: ${Math.round(scale * 100)}%`;
        }

        function updateStatus(text) {
            if (text) {
                document.getElementById('statusText').textContent = text;
            } else {
                updateStats();
            }
        }

        // ==================== å­˜æ¡£æ“ä½œ ====================
        window.resetGameState = function() {
            if (confirm('æ¸…é™¤æ‰€æœ‰å­˜æ¡£ï¼Ÿæ¸¸æˆè¿›åº¦å°†é‡ç½®ã€‚')) {
                GameState.resetState();
                location.reload();
            }
        };

        window.handleFileImport = function(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (e) => {
                if (GameState.importState(e.target.result)) {
                    alert('å¯¼å…¥æˆåŠŸï¼Œé¡µé¢å°†é‡æ–°åŠ è½½ã€‚');
                    location.reload();
                } else {
                    alert('å¯¼å…¥å¤±è´¥ï¼Œæ–‡ä»¶æ ¼å¼ä¸æ­£ç¡®ã€‚');
                }
            };
            reader.readAsText(file);
        };

        // ==================== äº‹ä»¶ç›‘å¬ ====================
        function setupEventListeners() {
            // å…¨å±€é¼ æ ‡äº‹ä»¶
            document.addEventListener('mousemove', (e) => {
                if (isDragging && dragNode) {
                    const worldPos = screenToWorld(e.clientX - dragOffset.x, e.clientY - dragOffset.y);
                    dragNode.dataset.x = worldPos.x;
                    dragNode.dataset.y = worldPos.y;
                    updateNodePosition(dragNode, worldPos.x, worldPos.y);
                    drawConnections();

                    const trashZone = document.getElementById('trash-zone');
                    if (e.clientY > window.innerHeight - 100) {
                        trashZone.classList.add('active');
                    } else {
                        trashZone.classList.remove('active');
                    }
                }

                if (isPanning) {
                    offsetX = panOffsetStart.x - (e.clientX - panStart.x) / scale;
                    offsetY = panOffsetStart.y - (e.clientY - panStart.y) / scale;
                    updateTransform();
                }
            });

            document.addEventListener('mouseup', (e) => {
                if (isDragging && dragNode) {
                    if (e.clientY > window.innerHeight - 100) {
                        const nodeId = dragNode.id;
                        dragNode.remove();
                        nodes = nodes.filter(n => n.id !== nodeId);
                        connections = connections.filter(c => c.from !== nodeId && c.to !== nodeId);
                        selectedNodes = selectedNodes.filter(id => id !== nodeId);
                        drawConnections();
                        updateStats();
                    }

                    dragNode.classList.remove('dragging');
                    nodeLayer.classList.remove('dragging-node');
                    isDragging = false;
                    dragNode = null;
                    document.getElementById('trash-zone').classList.remove('active');
                }

                isPanning = false;
            });

            // ç”»å¸ƒæ‹–æ‹½
            nodeLayer.addEventListener('mousedown', (e) => {
                if (e.target === nodeLayer && !connectMode && !mergeMode) {
                    isPanning = true;
                    panStart = { x: e.clientX, y: e.clientY };
                    panOffsetStart = { x: offsetX, y: offsetY };
                    nodeLayer.style.cursor = 'grabbing';
                }
            });

            nodeLayer.addEventListener('mouseup', () => {
                nodeLayer.style.cursor = 'grab';
            });

            // æ»šè½®ç¼©æ”¾
            container.addEventListener('wheel', (e) => {
                e.preventDefault();
                const delta = e.deltaY > 0 ? -CONFIG.zoomStep : CONFIG.zoomStep;
                scale = Math.max(CONFIG.scaleMin, Math.min(CONFIG.scaleMax, scale + delta));
                updateTransform();
            }, { passive: false });

            // é”®ç›˜äº‹ä»¶
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Delete' && selectedNodes.length > 0) {
                    deleteSelected();
                }
                if (e.key === 'Escape') {
                    connectMode = false;
                    mergeMode = false;
                    connectStart = null;
                    mergeStart = null;
                    document.getElementById('connectBtn').classList.remove('active');
                    document.getElementById('mergeBtn').classList.remove('active');
                    document.getElementById('modeIndicator').classList.remove('active');
                    document.getElementById('merge-hint').classList.remove('active');
                    document.querySelectorAll('.node.selected').forEach(n => n.classList.remove('selected'));
                    selectedNodes = [];
                    drawConnections();
                    updateStats();
                }
            });

            // ç‚¹å‡»ç©ºç™½å¤„å…³é—­å³é”®èœå•
            document.addEventListener('click', (e) => {
                if (!e.target.closest('.context-menu')) {
                    hideContextMenu();
                }
            });

            // è¿”å›é¡¶éƒ¨
            const goTop = document.getElementById('go-top');
            if (goTop) {
                goTop.addEventListener('click', () => {
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                });

                window.addEventListener('scroll', () => {
                    if (window.scrollY > 400) {
                        goTop.style.opacity = 1;
                        goTop.style.pointerEvents = 'auto';
                    } else {
                        goTop.style.opacity = 0;
                        goTop.style.pointerEvents = 'none';
                    }
                });
            }
        }

        // ==================== åˆå§‹åŒ– ====================
        document.addEventListener('DOMContentLoaded', init);

        // å°†å¿…è¦å‡½æ•°æŒ‚è½½åˆ°windowå¯¹è±¡ï¼Œä¾›HTML onclickè°ƒç”¨
        window.performSearch = performSearch;
        window.openNewsDetail = openNewsDetail;
        window.addNode = addNode;
        window.toggleConnectMode = toggleConnectMode;
        window.toggleMergeMode = toggleMergeMode;
        window.deleteSelected = deleteSelected;
        window.toggleBookmark = toggleBookmark;
        window.toggleUnknown = toggleUnknown;
        window.toggleCluePanel = toggleCluePanel;
        window.exportGameProgress = exportGameProgress;  // æ–°å¢å¯¼å‡ºå‡½æ•°
        window.resetView = resetView;
        window.zoomIn = zoomIn;
        window.zoomOut = zoomOut;
        window.editNode = editNode;
        window.openNewsFromContext = openNewsFromContext;
        window.tryMergeFromContext = tryMergeFromContext;
    </script>
</body>
</html>
